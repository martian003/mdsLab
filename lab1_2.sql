CREATE DATABASE hello;

CREATE TABLE SUPPLIERS
(
SUPPLIER_NUMBER VARCHAR(255) PRIMARY KEY,
SUPPLIER_NAME VARCHAR(255),
STATUS INT,
CITY VARCHAR(255)
);
INSERT INTO SUPPLIERS(SUPPLIER_NUMBER, SUPPLIER_NAME,STATUS,CITY )
VALUES
('S1','SARALA',20,'BOMBAY'),
('S2','UMA',10,'CHENNAI'),
('S3','NEHRU',30,'CHENNAI'),
('S4','PRIYA',20,'BOMBAY'),
('S5','ANAND',30,'DELHI');

SELECT * FROM SUPPLIERS;

CREATE TABLE  PARTS
(
PART_NUMBER VARCHAR(255) PRIMARY KEY,
PROJECT_NAME VARCHAR(255),
COLOR VARCHAR(255),
WEIGHT FLOAT,
CITY VARCHAR(255)
);
INSERT INTO PARTS(PART_NUMBER,PROJECT_NAME,COLOR,WEIGHT,CITY )
VALUES
('P1','NUT','RED',12.0,'BOMBAY'),
('P2','BOLT','GREEN',17.0,'CHENNAI'),
('P3','SCREW','BLUE',17.0,'BANGLORE'),
('P4','SCREW','RED',14.0,'BOMBAY'),
('P5','CAM','BLUE',12.0,'CHENNAI'),
('P6','COG','RED',19.0,'BOMBAY');


SELECT * FROM PARTS;

CREATE TABLE PROJECTS
(
PROJECT_NUMBER VARCHAR(255) PRIMARY KEY,
PROJECT_NAME VARCHAR(255),
CITY VARCHAR(255)
);
INSERT INTO PROJECTS(PROJECT_NUMBER,PROJECT_NAME,CITY )
VALUES
('J1','SORTER','CHENNAI'),
('J2','DISPLAY','NELLAI'),
('J3','OCR','DELHI'),
('J4','CONSOLE','DELHI'),
('J5','RAID','BOMBAY'),
('J6','EDS','BANGLORE'),
('J7','TAPE','BOMBAY');
SELECT * FROM PROJECTS;

CREATE TABLE SHIPMENTS
(
SUPPLIER_NUMBER VARCHAR(255),
PART_NUMBER VARCHAR(255),
PROJECT_NUMBER VARCHAR(255),
QUANTITY INT
);
INSERT INTO SHIPMENTS(SUPPLIER_NUMBER,PART_NUMBER,PROJECT_NUMBER,QUANTITY )
VALUES
('S1','P1','J1',200),
('S1','P1','J4',700),
('S2','P3','J1',400),
('S2','P3','J2',200),
('S2','P3','J3',200),
('S2','P3','J4',500),
('S2','P3','J5',600),
('S2','P3','J6',400),
('S2','P3','J7',800),
('S2','P5','J2',100),
('S3','P3','J1',200),
('S3','P4','J2',500),
('S4','P6','J3',300),
('S4','P6','J7',300),
('S5','P2','J2',200),
('S5','P2','J4',100),
('S5','P5','J5',500),
('S5','P5','J7',100),
('S5','P6','J2',200),
('S5','P1','J4',100),
('S5','P3','J4',200),
('S5','P4','J4',800),
('S5','P5','J4',400),
('S5','P6','J4',500);

SELECT * FROM SHIPMENTS;

SELECT * FROM PROJECTS;

SELECT * FROM PROJECTS WHERE CITY = BOMBAY;

SELECT DISTINCT s.SUPPLIER_NAME
FROM SUPPLIERS s
JOIN SHIPMENTS sh ON s.SUPPLIER_NUMBER = sh.SUPPLIER_NUMBER
JOIN PROJECTS p ON sh.PROJECT_NUMBER = p.PROJECT_NUMBER
WHERE p.PROJECT_NUMBER = 'J1';

SELECT * FROM SHIPMENTS WHERE QUANTITY>=300 AND QUANTITY<=750;

SELECT COLOR, CITY
FROM PARTS;

SELECT DISTINCT
    S.SUPPLIER_NUMBER,
    PA.PART_NUMBER,
    PR.PROJECT_NUMBER
FROM
    SHIPMENTS SH
JOIN SUPPLIERS S ON S.SUPPLIER_NUMBER = SH.SUPPLIER_NUMBER
JOIN PARTS PA ON PA.PART_NUMBER = SH.PART_NUMBER
JOIN PROJECTS PR ON PR.PROJECT_NUMBER = SH.PROJECT_NUMBER
WHERE
    S.CITY = PA.CITY
    AND PA.CITY = PR.CITY
    AND S.CITY = PR.CITY;


SELECT DISTINCT
    S.SUPPLIER_NUMBER,
    PA.PART_NUMBER,
    PR.PROJECT_NUMBER
FROM
    SHIPMENTS SH
JOIN SUPPLIERS S ON S.SUPPLIER_NUMBER = SH.SUPPLIER_NUMBER
JOIN PARTS PA ON PA.PART_NUMBER = SH.PART_NUMBER
JOIN PROJECTS PR ON PR.PROJECT_NUMBER = SH.PROJECT_NUMBER
WHERE
    S.CITY != PA.CITY
    AND PA.CITY != PR.CITY
    AND S.CITY != PR.CITY;


SELECT DISTINCT
    S.SUPPLIER_NUMBER,
    PA.PART_NUMBER,
    PR.PROJECT_NUMBER
FROM
    SHIPMENTS SH
JOIN SUPPLIERS S ON S.SUPPLIER_NUMBER = SH.SUPPLIER_NUMBER
JOIN PARTS PA ON PA.PART_NUMBER = SH.PART_NUMBER
JOIN PROJECTS PR ON PR.PROJECT_NUMBER = SH.PROJECT_NUMBER
WHERE
    S.CITY != PA.CITY
    OR PA.CITY != PR.CITY
    OR S.CITY != PR.CITY;
    
SELECT DISTINCT
    P.PART_NUMBER,
    P.PROJECT_NAME,
    P.COLOR,
    P.WEIGHT,
    P.CITY
FROM
    PARTS P
JOIN SHIPMENTS SH ON SH.PART_NUMBER = P.PART_NUMBER
JOIN SUPPLIERS S ON SH.SUPPLIER_NUMBER = S.SUPPLIER_NUMBER
WHERE
    S.CITY = 'Bombay';
    
SELECT DISTINCT
    PA.PART_NUMBER
FROM
    PARTS PA
JOIN SHIPMENTS SH ON SH.PART_NUMBER = PA.PART_NUMBER
JOIN SUPPLIERS S ON SH.SUPPLIER_NUMBER = S.SUPPLIER_NUMBER
JOIN PROJECTS PR ON SH.PROJECT_NUMBER = PR.PROJECT_NUMBER
WHERE
    S.CITY = 'Bombay'
    AND PR.CITY = 'Bombay';
    

    
SELECT DISTINCT
    S.CITY AS SUPPLIER_CITY,
    PR.CITY AS PROJECT_CITY
FROM
    SHIPMENTS SH
JOIN SUPPLIERS S ON SH.SUPPLIER_NUMBER = S.SUPPLIER_NUMBER
JOIN PROJECTS PR ON SH.PROJECT_NUMBER = PR.PROJECT_NUMBER
WHERE
    S.CITY <> PR.CITY;


SELECT DISTINCT
    PR.PROJECT_NUMBER
FROM
    SHIPMENTS SH
JOIN SUPPLIERS S ON SH.SUPPLIER_NUMBER = S.SUPPLIER_NUMBER
JOIN PROJECTS PR ON SH.PROJECT_NUMBER = PR.PROJECT_NUMBER
WHERE
    S.CITY <> PR.CITY;


SELECT DISTINCT
    SH1.PART_NUMBER AS PART1,
    SH2.PART_NUMBER AS PART2
FROM
    SHIPMENTS SH1
JOIN SHIPMENTS SH2 ON SH1.SUPPLIER_NUMBER = SH2.SUPPLIER_NUMBER
WHERE
    SH1.PART_NUMBER <> SH2.PART_NUMBER;
    
SELECT COUNT(DISTINCT SH.PROJECT_NUMBER) AS TotalProjects
FROM SHIPMENTS SH
WHERE SH.SUPPLIER_NUMBER = 'S1';


SELECT DISTINCT
    PA.COLOR
FROM
    SHIPMENTS SH
JOIN PARTS PA ON SH.PART_NUMBER = PA.PART_NUMBER
WHERE
    SH.SUPPLIER_NUMBER = 'S1';
    
SELECT SUM(SH.QUANTITY) AS TotalQuantity
FROM SHIPMENTS SH
WHERE SH.SUPPLIER_NUMBER = 'S1'
AND SH.PART_NUMBER = 'P1';

SELECT
    SH.PART_NUMBER,
    SH.PROJECT_NUMBER,
    SUM(SH.QUANTITY) AS TotalQuantity
FROM
    SHIPMENTS SH
GROUP BY
    SH.PART_NUMBER,
    SH.PROJECT_NUMBER;



SELECT DISTINCT SH.PART_NUMBER
FROM SHIPMENTS SH
WHERE SH.PROJECT_NUMBER IN (
    SELECT PROJECT_NUMBER
    FROM (
        SELECT PROJECT_NUMBER, AVG(QUANTITY) AS AVG_QUANTITY
        FROM SHIPMENTS
        GROUP BY PROJECT_NUMBER
    ) AS AvgQuantities
    WHERE AVG_QUANTITY > 350
);

SELECT DISTINCT SH.PART_NUMBER
FROM SHIPMENTS SH
WHERE SH.PROJECT_NUMBER IN (
    SELECT PR.PROJECT_NUMBER
    FROM PROJECTS PR
    WHERE PR.CITY = 'BOMBAY'
);


SELECT DISTINCT S1.SUPPLIER_NUMBER
FROM SHIPMENTS S1
WHERE S1.PART_NUMBER IN (
    SELECT DISTINCT S2.PART_NUMBER
    FROM SHIPMENTS S2
    WHERE S2.SUPPLIER_NUMBER IN (
        SELECT DISTINCT S3.SUPPLIER_NUMBER
        FROM SHIPMENTS S3
        JOIN PARTS P ON S3.PART_NUMBER = P.PART_NUMBER
        WHERE P.COLOR = 'RED'
    )
);


SELECT SUPPLIER_NUMBER
FROM SUPPLIERS
WHERE STATUS < (
    SELECT STATUS
    FROM SUPPLIERS
    WHERE SUPPLIER_NUMBER = 'S1'
);


SELECT PROJECT_NUMBER
FROM (
    SELECT PROJECT_NUMBER, AVG(QUANTITY) AS AVG_QUANTITY
    FROM SHIPMENTS
    WHERE PART_NUMBER = 'P1'
    GROUP BY PROJECT_NUMBER
) AS AvgQuantities
WHERE AVG_QUANTITY > (
    SELECT MAX(QUANTITY)
    FROM SHIPMENTS
    WHERE PROJECT_NUMBER = 'J1'
);


SELECT DISTINCT SH.SUPPLIER_NUMBER
FROM SHIPMENTS SH
WHERE SH.PART_NUMBER = 'P1'
  AND SH.QUANTITY < (
      SELECT AVG(QUANTITY)
      FROM SHIPMENTS
      WHERE PART_NUMBER = 'P1'
        AND PROJECT_NUMBER = SH.PROJECT_NUMBER
  );
  
  SELECT PROJECT_NUMBER
FROM PROJECTS
WHERE CITY = (
    SELECT MIN(CITY)
    FROM PROJECTS
);









